<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لوحة التحكم الإدارية</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <style>
        :root {
    --primary: #1e40af;
    --secondary: #858796;
    --success: #1cc88a;
    --info: #36b9cc;
    --warning: #f6c23e;
    --danger: #e74a3b;
    --light: #f8f9fc;
    --dark: #5a5c69;
}

/* Base RTL Settings */
html[dir="rtl"] {
    direction: rtl;
}

body {
    font-family: 'Tajawal', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background-color: #f8f9fc;
    text-align: right;
}

/* Main Layout Structure */
#wrapper {
    display: flex;
    flex-direction: row; /* Standard row direction */
}

#sidebar {
    width: 250px;
    min-height: 100vh;
    background: linear-gradient(180deg, var(--primary) 10%, #091439 100%);
    color: white;
    transition: all 0.3s;
    margin-left: auto; /* Pushes sidebar to the right */
    border-left: 1px solid rgba(255, 255, 255, 0.1);
    border-right: none;
}

#content {
    flex: 1;
    min-height: 100vh;
    overflow-x: hidden;
}

/* Sidebar Components */
.sidebar-brand {
    height: 4.375rem;
    text-decoration: none;
    font-size: 1.2rem;
    font-weight: 800;
    padding: 1.5rem 1rem;
    text-align: center;
    letter-spacing: 0.05rem;
    z-index: 1;
    color: white;
}

.sidebar-divider {
    border-top: 1px solid rgba(255, 255, 255, 0.15);
    margin: 0 1rem 1rem;
}

.sidebar-heading {
    text-align: right;
    padding: 0 1rem;
    font-weight: 800;
    font-size: 0.65rem;
    color: rgba(255, 255, 255, 0.4);
}

.nav-item {
    position: relative;
}

.nav-link {
    color: rgba(255, 255, 255, 0.8);
    padding: 0.75rem 1rem;
    font-weight: 700;
    font-size: 0.85rem;
}

.nav-link i {
    margin-right: 0.25rem; /* Adjusted for RTL */
    margin-left: 0;
}

.nav-link.active {
    color: white;
}

.nav-link:hover {
    color: white;
}

/* Top Bar */
.topbar {
    height: 4.375rem;
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
    background-color: white;
}

.topbar .navbar-search {
    width: 25rem;
}

.topbar .navbar-search input {
    font-size: 0.85rem;
    height: auto;
}

.topbar .topbar-divider {
    width: 0;
    border-right: 1px solid #e3e6f0;
    height: calc(4.375rem - 2rem);
    margin: auto 1rem;
}

.topbar .nav-item .nav-link {
    height: 4.375rem;
    display: flex;
    align-items: center;
    padding: 0 0.75rem;
    color: #d1d3e2;
}

.topbar .nav-item .nav-link:hover {
    color: #b7b9cc;
}

.topbar .dropdown-list {
    padding: 0;
    border: none;
    overflow: hidden;
    width: 20rem !important;
}

/* Cards */
.card {
    border: none;
    border-radius: 0.35rem;
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.1);
    margin-bottom: 1.5rem;
}

.card-header {
    background-color: #f8f9fc;
    border-bottom: 1px solid #e3e6f0;
    padding: 1rem 1.35rem;
    font-weight: 700;
    text-align: right;
}

.card-body {
    padding: 1.25rem;
}

/* Tables */
#productsTable img {
    max-height: 50px;
    max-width: 50px;
    border-radius: 4px;
    object-fit: cover;
}

#productsTable td {
    vertical-align: middle;
    text-align: right;
}

/* Color Classes */
.bg-primary {
    background-color: var(--primary) !important;
}

.bg-success {
    background-color: var(--success) !important;
}

.bg-info {
    background-color: var(--info) !important;
}

.bg-warning {
    background-color: var(--warning) !important;
}

.bg-danger {
    background-color: var(--danger) !important;
}

.text-primary {
    color: var(--primary) !important;
}

.text-success {
    color: var(--success) !important;
}

.text-info {
    color: var(--info) !important;
}

.text-warning {
    color: var(--warning) !important;
}

.text-danger {
    color: var(--danger) !important;
}

/* Charts */
.chart-area {
    position: relative;
    height: 10rem;
    width: 100%;
}

.chart-pie {
    position: relative;
    height: 15rem;
    width: 100%;
}

/* Buttons */
.btn-primary {
    background-color: var(--primary);
    border-color: var(--primary);
}

.btn-primary:hover {
    background-color: #2e59d9;
    border-color: #2653d4;
}

/* Pagination */
.page-item.active .page-link {
    background-color: var(--primary);
    border-color: var(--primary);
}

.page-link {
    color: var(--primary);
}

/* Dropdowns */
.dropdown-menu {
    font-size: 0.85rem;
    text-align: right;
    right: auto !important;
    left: 0 !important;
}

.dropdown-header {
    font-weight: 800;
    font-size: 0.65rem;
    color: #b7b9cc;
}

/* Tabs */
.tab-content {
    padding: 1.25rem 0;
}

/* Dashboard Sections */
.dashboard-section {
    display: none;
}

.dashboard-section.active {
    display: block;
}

/* Stats Cards */
.stat-card {
    border-left: none;
    border-right: 0.25rem solid;
    border-radius: 0.35rem;
}

.stat-card .stat-icon {
    font-size: 2rem;
    opacity: 0.3;
}

/* DataTables RTL Adjustments */
.dataTables_wrapper .dataTables_filter {
    float: left;
}

.dataTables_wrapper .dataTables_length {
    text-align: right;
}

.dataTables_wrapper .dataTables_info {
    text-align: right;
}

.dataTables_wrapper .dataTables_paginate {
    text-align: left;
}

/* Modal RTL Adjustments */
.modal-header {
    flex-direction: row-reverse;
}

/* Form Elements */
.form-group label {
    text-align: right;
    display: block;
}

/* Table Cell Alignment */
table th, table td {
    text-align: right;
}

/* Additional RTL Fixes */
[dir="rtl"] {
    /* Flip icon margins */
    .fa, .fas, .far, .fal, .fab {
        margin-right: 0.25rem;
        margin-left: 0;
    }
    
    /* Adjust breadcrumbs */
    .breadcrumb-item + .breadcrumb-item::before {
        float: right;
        padding-left: 0.5rem;
        padding-right: 0;
    }
    
    /* Fix button groups */
    .btn-group > .btn:not(:first-child),
    .btn-group > .btn-group:not(:first-child) {
        margin-right: -1px;
        margin-left: 0;
    }
}

/* Notification styles */
.icon-circle {
    height: 2.5rem;
    width: 2.5rem;
    border-radius: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.toast {
    direction: rtl;
    text-align: right;
}

.dropdown-list {
    padding: 0;
    border: none;
    overflow: hidden;
    width: 20rem !important;
}

.dropdown-header {
    font-weight: 800;
    font-size: 0.65rem;
    color: #b7b9cc;
    text-align: right;
}

.badge-counter {
    position: absolute;
    transform: scale(0.7);
    transform-origin: top right;
    right: 0.25rem;
    margin-top: -0.25rem;
}
    </style>
</head>
<body>
    <div id="wrapper">
        <!-- Sidebar -->
        <div id="sidebar">
            <div class="sidebar-brand d-flex align-items-center justify-content-center">
                <div class="sidebar-brand-icon">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="sidebar-brand-text mx-3">إدارة المنتجات</div>
            </div>
            
            <div class="sidebar-divider"></div>
            
            <div class="sidebar-heading">الأساسيات</div>
            
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link active" href="#" data-section="dashboard">
                        <i class="fas fa-fw fa-tachometer-alt"></i>
                        <span>لوحة التحكم</span>
                    </a>
                </li>
                
                <div class="sidebar-divider"></div>
                
                <div class="sidebar-heading">الإدارة</div>
                
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="products">
                        <i class="fas fa-fw fa-box-open"></i>
                        <span>المنتجات</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="categories">
                        <i class="fas fa-fw fa-tags"></i>
                        <span>الفئات</span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="messages">
                        <i class="fas fa-fw fa-envelope"></i>
                        <span>الرسائل</span>
                        <span id="unreadMessagesBadge" class="badge bg-danger rounded-pill ms-2 d-none">0</span>
                        
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="#" data-section="quotes">
                        <i class="fas fa-fw fa-file-invoice-dollar"></i>
                        <span>طلبات العروض</span>
                        <span id="unreadQuotesBadge" class="badge bg-danger rounded-pill ms-2 d-none">0</span>
                    </a>
                </li>
                <li class="nav-item mt-auto">
                    <a class="nav-link" href="#" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>تسجيل الخروج</span>
                    </a>
                </li>
            </ul>
            <!-- Topbar Navbar -->

        </div>
        
        <!-- Content -->
        <div id="content">
            <br><br>
            <!-- Main Content -->
            <div class="container-fluid">
                <!-- Dashboard Section -->
                <div class="dashboard-section active" id="dashboard-section">
                    
                    <!-- Content Row -->
                    <div class="row">
                        <!-- Products Card -->
<div class="col-xl-3 col-md-6 mb-4">
    <div class="card stat-card border-left-success shadow h-100 py-2">
        <div class="card-body">
            <div class="row no-gutters align-items-center">
                <div class="col mr-2">
                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                        المنتجات</div>
                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="productsCount">215</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-box-open fa-2x text-gray-300 stat-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Messages Card -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card stat-card border-left-info shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">الرسائل
                                    </div>
                                    <div class="row no-gutters align-items-center">
                                        <div class="col-auto">
                                            <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800" id="messagesCount">12</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-envelope fa-2x text-gray-300 stat-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quote Requests Card -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card stat-card border-left-warning shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                        طلبات العروض</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="quotesCount">18</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-file-invoice-dollar fa-2x text-gray-300 stat-icon"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                    </div>
                    
                    <!-- Content Row -->
                    <div class="row">
                        <!-- Area Chart -->
                        <div class="col-xl-8 col-lg-7">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">نظرة عامة على الأرباح</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in">
                                            <div class="dropdown-header">خيارات:</div>
                                            <a class="dropdown-item" href="#">إجراء</a>
                                            <a class="dropdown-item" href="#">إجراء آخر</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">شيء آخر</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-area">
                                        <canvas id="myAreaChart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pie Chart -->
                        <div class="col-xl-4 col-lg-5">
                            <div class="card shadow mb-4">
                                <!-- Card Header - Dropdown -->
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold text-primary">مصادر الإيرادات</h6>
                                    <div class="dropdown no-arrow">
                                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-bs-toggle="dropdown">
                                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                                        </a>
                                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in">
                                            <div class="dropdown-header">خيارات:</div>
                                            <a class="dropdown-item" href="#">إجراء</a>
                                            <a class="dropdown-item" href="#">إجراء آخر</a>
                                            <div class="dropdown-divider"></div>
                                            <a class="dropdown-item" href="#">شيء آخر</a>
                                        </div>
                                    </div>
                                </div>
                                <!-- Card Body -->
                                <div class="card-body">
                                    <div class="chart-pie pt-4 pb-2">
                                        <canvas id="myPieChart"></canvas>
                                    </div>
                                    <div class="mt-4 text-center small">
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-primary"></i> مباشر
                                        </span>
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-success"></i> اجتماعي
                                        </span>
                                        <span class="mr-2">
                                            <i class="fas fa-circle text-info"></i> إحالة
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Products Section -->
                <div class="dashboard-section" id="products-section">
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">المنتجات</h1>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addProductModal">
                            <i class="fas fa-plus"></i> إضافة منتج
                        </button>
                    </div>
                    
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">قائمة المنتجات</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="productsTable" width="100%" cellspacing="0">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>الصورة</th>
                                            <th>الاسم</th>
                                            <th>الفئة</th>
                                            <th>الوصف</th>
                                            <th>تاريخ الإضافة</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Products will be loaded here via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View Product Modal -->
<div class="modal fade" id="viewProductModal" tabindex="-1" role="dialog" aria-labelledby="viewProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewProductModalLabel">تفاصيل المنتج</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>اسم المنتج:</label>
                            <p id="viewProductName"></p>
                        </div>
                        <div class="form-group">
                            <label>الفئة:</label>
                            <p id="viewProductCategory"></p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>تاريخ الإضافة:</label>
                            <p id="viewProductCreatedAt"></p>
                        </div>
                        <div class="form-group">
                            <label>آخر تحديث:</label>
                            <p id="viewProductUpdatedAt"></p>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>الوصف:</label>
                    <p id="viewProductDescription"></p>
                </div>
                <div class="form-group">
                    <label>صورة المنتج:</label>
                    <div id="viewProductImageContainer" class="mt-2">
                        <!-- Image will be inserted here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Product Modal -->
<div class="modal fade" id="editProductModal" tabindex="-1" role="dialog" aria-labelledby="editProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editProductModalLabel">تعديل المنتج</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editProductForm">
                    <input type="hidden" id="editProductId">
                    <div class="form-group">
                        <label for="editProductName">اسم المنتج</label>
                        <input type="text" class="form-control" id="editProductName" required>
                    </div>
                    <div class="form-group">
                        <label for="editProductDescription">الوصف</label>
                        <textarea class="form-control" id="editProductDescription" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="editProductCategory">الفئة</label>
                        <select class="form-control" id="editProductCategory" required>
                            <!-- Categories will be loaded here -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="editProductImage">صورة المنتج</label>
                        <input type="file" class="form-control-file" id="editProductImage">
                        <small class="form-text text-muted">اتركه فارغًا للحفاظ على الصورة الحالية</small>
                        <div id="currentProductImage" class="mt-2">
                            <!-- Current image will be shown here -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                <button type="button" class="btn btn-primary" id="updateProductBtn">تحديث المنتج</button>
            </div>
        </div>
    </div>
</div>
               
                <!-- Categories Section -->
                <div class="dashboard-section" id="categories-section">
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">الفئات</h1>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addCategoryModal">
                            <i class="fas fa-plus"></i> إضافة فئة
                        </button>
                    </div>
                    
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">قائمة الفئات</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="categoriesTable" width="100%" cellspacing="0">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>الاسم</th>
                                            <th>تاريخ الإضافة</th>
                                            <th>آخر تحديث</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Categories will be loaded here via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- View Category Modal -->
<div class="modal fade" id="viewCategoryModal" tabindex="-1" role="dialog" aria-labelledby="viewCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewCategoryModalLabel">تفاصيل الفئة</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>اسم الفئة:</label>
                    <p id="viewCategoryName"></p>
                </div>
                <div class="form-group">
                    <label>تاريخ الإضافة:</label>
                    <p id="viewCategoryCreatedAt"></p>
                </div>
                <div class="form-group">
                    <label>آخر تحديث:</label>
                    <p id="viewCategoryUpdatedAt"></p>
                </div>
                <div class="form-group">
                    <label>عدد المنتجات:</label>
                    <p id="viewCategoryProductCount"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Category Modal -->
<div class="modal fade" id="editCategoryModal" tabindex="-1" role="dialog" aria-labelledby="editCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCategoryModalLabel">تعديل الفئة</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="editCategoryForm">
                    <input type="hidden" id="editCategoryId">
                    <div class="form-group">
                        <label for="editCategoryName">اسم الفئة</label>
                        <input type="text" class="form-control" id="editCategoryName" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                <button type="button" class="btn btn-primary" id="updateCategoryBtn">تحديث الفئة</button>
            </div>
        </div>
    </div>
</div>

                <!-- Messages Section -->
                <div class="dashboard-section" id="messages-section">
                    <div class="d-sm-flex align-items-center justify-content-between mb-4">
                        <h1 class="h3 mb-0 text-gray-800">رسائل التواصل</h1>
                    </div>
                    
                    <div class="card shadow mb-4">
                        <div class="card-header py-3 d-flex justify-content-between align-items-center">
                            <h6 class="m-0 font-weight-bold text-primary">الرسائل</h6>
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-primary">الكل</button>
                                <button type="button" class="btn btn-sm btn-outline-primary">غير المقروءة</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="messagesTable" width="100%" cellspacing="0">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>الاسم</th>
                                            <th>البريد الإلكتروني</th>
                                            <th>الهاتف</th>
                                            <th>الرسالة</th>
                                            <th>تاريخ الإرسال</th>
                                            <th>الحالة</th>
                                            <th>الإجراءات</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Messages will be loaded here via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quotes Section -->
<div class="dashboard-section" id="quotes-section">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">طلبات العروض</h1>
    </div>
    
    <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
            <h6 class="m-0 font-weight-bold text-primary">طلبات العروض</h6>
            <div class="btn-group">
                <button type="button" class="btn btn-sm btn-outline-primary">الكل</button>
                <button type="button" class="btn btn-sm btn-outline-primary">غير المقروءة</button>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered" id="quotesTable" width="100%" cellspacing="0">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>الاسم الكامل</th>
                            <th>الشركة</th>
                            <th>البريد الإلكتروني</th>
                            <th>الهاتف</th>
                            <th>الدولة</th>
                            <th>المدينة</th>
                            <th>المنتجات</th>
                            <th>تاريخ الإرسال</th>
                            <th>الحالة</th>
                            <th>الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Quotes will be loaded here via JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- View Quote Modal -->
<div class="modal fade" id="viewQuoteModal" tabindex="-1" role="dialog" aria-labelledby="viewQuoteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewQuoteModalLabel">تفاصيل طلب العرض</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>الاسم الكامل:</label>
                            <p id="quoteFullName"></p>
                        </div>
                        <div class="form-group">
                            <label>الشركة:</label>
                            <p id="quoteCompany"></p>
                        </div>
                        <div class="form-group">
                            <label>البريد الإلكتروني:</label>
                            <p id="quoteEmail"></p>
                        </div>
                        <div class="form-group">
                            <label>الهاتف:</label>
                            <p id="quotePhone"></p>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>الدولة:</label>
                            <p id="quoteCountry"></p>
                        </div>
                        <div class="form-group">
                            <label>المدينة:</label>
                            <p id="quoteCity"></p>
                        </div>
                        <div class="form-group">
                            <label>العنوان:</label>
                            <p id="quoteAddress"></p>
                        </div>
                        <div class="form-group">
                            <label>تاريخ الإرسال:</label>
                            <p id="quoteSubmittedAt"></p>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-12">
                        <div class="form-group">
                            <label>تفاصيل المنتجات:</label>
                            <div id="quoteProductDetails"></div>
                        </div>
                        <div class="form-group">
                            <label>الكمية الإجمالية:</label>
                            <p id="quoteQuantity"></p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                <button type="button" class="btn btn-success" id="markQuoteAsReadBtn">تحديد كمقروء</button>
            </div>
        </div>
    </div>
</div>
            
            <!-- Footer -->
           
            <!-- End of Footer -->
        </div>
    </div>
    
    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1" role="dialog" aria-labelledby="addProductModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addProductModalLabel">إضافة منتج جديد</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <div class="form-group">
                            <label for="productName">اسم المنتج</label>
                            <input type="text" class="form-control" id="productName" required>
                        </div>
                        <div class="form-group">
                            <label for="productDescription">الوصف</label>
                            <textarea class="form-control" id="productDescription" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="productCategory">الفئة</label>
                            <select class="form-control" id="productCategory" required>
                                <!-- Categories will be loaded here via JavaScript -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="productImage">صورة المنتج</label>
                            <input type="file" class="form-control-file" id="productImage" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" id="saveProductBtn">حفظ المنتج</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Category Modal -->
    <div class="modal fade" id="addCategoryModal" tabindex="-1" role="dialog" aria-labelledby="addCategoryModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addCategoryModalLabel">إضافة فئة جديدة</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="categoryForm">
                        <div class="form-group">
                            <label for="categoryName">اسم الفئة</label>
                            <input type="text" class="form-control" id="categoryName" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-primary" id="saveCategoryBtn">حفظ الفئة</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- View Message Modal -->
    <div class="modal fade" id="viewMessageModal" tabindex="-1" role="dialog" aria-labelledby="viewMessageModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewMessageModalLabel">تفاصيل الرسالة</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>الاسم:</label>
                        <p id="messageName"></p>
                    </div>
                    <div class="form-group">
                        <label>البريد الإلكتروني:</label>
                        <p id="messageEmail"></p>
                    </div>
                    <div class="form-group">
                        <label>الهاتف:</label>
                        <p id="messagePhone"></p>
                    </div>
                    <div class="form-group">
                        <label>الرسالة:</label>
                        <p id="messageContent"></p>
                    </div>
                    <div class="form-group">
                        <label>تاريخ الإرسال:</label>
                        <p id="messageSubmittedAt"></p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إغلاق</button>
                    <button type="button" class="btn btn-success" id="markAsReadBtn">تحديد كمقروء</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    
    <script>

        let lastMessageCount = 0;
        let lastQuoteCount = 0;


        // Check authentication
        document.addEventListener('DOMContentLoaded', function() {

            updateDashboardCounts();

            const token = localStorage.getItem('adminToken');
            if (!token && window.location.pathname !== '/login.html') {
                window.location.href = 'login.html';
            }
            
            // Initialize DataTables with Arabic language
            $('#ordersTable').DataTable({
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/1.13.4/i18n/ar.json'
                }
            });
            $('#productsTable').DataTable({
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/1.13.4/i18n/ar.json'
                }
            });
            $('#categoriesTable').DataTable({
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/1.13.4/i18n/ar.json'
                }
            });
            $('#messagesTable').DataTable({
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/1.13.4/i18n/ar.json'
                }
            });
            $('#quotesTable').DataTable({
                language: {
                    url: 'https://cdn.datatables.net/plug-ins/1.13.4/i18n/ar.json'
                }
            });
            
            // Load data for each section
            loadProducts();
            loadCategories();
            loadMessages();
            loadQuotes();
            
            // Initialize charts
            initCharts();
        });
        
        // Navigation between sections
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links and sections
                document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
                document.querySelectorAll('.dashboard-section').forEach(el => el.classList.remove('active'));
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Show corresponding section
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId + '-section').classList.add('active');
            });
        });
        
        // Logout functionality
        document.addEventListener('DOMContentLoaded', function() {
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    fetch('https://localhost:7158/api/Admin/logout', {
                        method: 'POST',
                        headers: {
                            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
                        }
                    })
                    .then(response => {
                        if (response.ok) {
                            localStorage.removeItem('adminToken');
                            window.location.href = 'login.html';
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                    });
                });
            }
        });
        
        // Initialize charts
        function initCharts() {
            // Area Chart
            const areaCtx = document.getElementById('myAreaChart').getContext('2d');
            const areaChart = new Chart(areaCtx, {
                type: 'line',
                data: {
                    labels: ["يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو", "يوليو", "أغسطس", "سبتمبر", "أكتوبر", "نوفمبر", "ديسمبر"],
                    datasets: [{
                        label: "الأرباح",
                        lineTension: 0.3,
                        backgroundColor: "rgba(78, 115, 223, 0.05)",
                        borderColor: "rgba(78, 115, 223, 1)",
                        pointRadius: 3,
                        pointBackgroundColor: "rgba(78, 115, 223, 1)",
                        pointBorderColor: "rgba(78, 115, 223, 1)",
                        pointHoverRadius: 3,
                        pointHoverBackgroundColor: "rgba(78, 115, 223, 1)",
                        pointHoverBorderColor: "rgba(78, 115, 223, 1)",
                        pointHitRadius: 10,
                        pointBorderWidth: 2,
                        data: [0, 10000, 5000, 15000, 10000, 20000, 15000, 25000, 20000, 30000, 25000, 40000],
                    }],
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'ر.س' + value.toLocaleString();
                                }
                            },
                            grid: {
                                color: "rgba(0, 0, 0, .125)",
                            }
                        }
                    }
                }
            });
            
            // Pie Chart
            const pieCtx = document.getElementById('myPieChart').getContext('2d');
            const pieChart = new Chart(pieCtx, {
                type: 'doughnut',
                data: {
                    labels: ["مباشر", "إحالة", "اجتماعي"],
                    datasets: [{
                        data: [55, 30, 15],
                        backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc'],
                        hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf'],
                        hoverBorderColor: "rgba(234, 236, 244, 1)",
                    }],
                },
                options: {
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    cutout: '80%',
                },
            });
        }
        function updateDashboardCounts() {
    const token = localStorage.getItem('adminToken');
    if (!token) return;

    // Fetch and count products
    fetch('https://localhost:7158/api/Products', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => response.json())
    .then(products => {
        document.getElementById('productsCount').textContent = products.length;
    })
    .catch(error => {
        console.error('Error fetching products:', error);
    });

    // Fetch and count messages
    fetch('https://localhost:7158/api/contact', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => response.json())
    .then(messages => {
        document.getElementById('messagesCount').textContent = messages.length;
    })
    .catch(error => {
        console.error('Error fetching messages:', error);
    });

    // Fetch and count quotes
    fetch('https://localhost:7158/api/Quotes', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => response.json())
    .then(quotes => {
        document.getElementById('quotesCount').textContent = quotes.length;
    })
    .catch(error => {
        console.error('Error fetching quotes:', error);
    });
}
        
        // Load products from API
        function loadProducts() {
    fetch('https://localhost:7158/api/Products', {
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
        }
    })
    .then(response => response.json())
    .then(data => {
        const tbody = document.querySelector('#productsTable tbody');
        tbody.innerHTML = '';
        
        data.forEach(product => {
            const row = document.createElement('tr');
            row.innerHTML = `
    <td>${product.id}</td>
    <td>
        ${product.imagePath ? 
            `<a href="${product.imagePath}" target="_blank" title="عرض صورة أكبر">
                <img src="${product.imagePath}" alt="${product.name}" style="max-height: 50px; max-width: 50px;">
            </a>` : 
            'لا توجد صورة'}
    </td>
                <td>${product.name}</td>
                <td>${product.categoryName}</td>
                <td>${product.description || '-'}</td>
                <td>${new Date(product.createdAt).toLocaleDateString()}</td>
                <td>
                    <button class="btn btn-sm btn-primary view-product-btn" data-id="${product.id}">عرض</button>
                    <button class="btn btn-sm btn-info edit-product-btn" data-id="${product.id}">تعديل</button>
                    <button class="btn btn-sm btn-danger delete-product-btn" data-id="${product.id}">حذف</button>
                </td>
            `;
            tbody.appendChild(row);
        });

        // Add event listeners to product buttons
        document.querySelectorAll('.view-product-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.getAttribute('data-id');
                viewProduct(productId);
            });
        });

        document.querySelectorAll('.edit-product-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.getAttribute('data-id');
                editProduct(productId);
            });
        });

        document.querySelectorAll('.delete-product-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.getAttribute('data-id');
                if (confirm('هل أنت متأكد أنك تريد حذف هذا المنتج؟')) {
                    deleteProduct(productId);
                }
            });
        });
    })
    .catch(error => {
        console.error('Error loading products:', error);
    });
}
        
       function loadCategories() {
    fetch('https://localhost:7158/api/categories', {
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
        }
    })
    .then(response => response.json())
    .then(data => {
        const tbody = document.querySelector('#categoriesTable tbody');
        tbody.innerHTML = '';
        
        data.forEach(category => {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${category.id}</td>
                <td>${category.name}</td>
                <td>${new Date(category.createdAt).toLocaleDateString()}</td>
                <td>${category.updatedAt ? new Date(category.updatedAt).toLocaleDateString() : '-'}</td>
                <td>
                    <button class="btn btn-sm btn-primary view-category-btn" data-id="${category.id}">عرض</button>
                    <button class="btn btn-sm btn-info edit-category-btn" data-id="${category.id}">تعديل</button>
                    <button class="btn btn-sm btn-danger delete-category-btn" data-id="${category.id}">حذف</button>
                </td>
            `;
            tbody.appendChild(row);
        });

        // Add event listeners to category buttons
        document.querySelectorAll('.view-category-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const categoryId = this.getAttribute('data-id');
                viewCategory(categoryId);
            });
        });

        document.querySelectorAll('.edit-category-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const categoryId = this.getAttribute('data-id');
                editCategory(categoryId);
            });
        });

        document.querySelectorAll('.delete-category-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const categoryId = this.getAttribute('data-id');
                if (confirm('هل أنت متأكد أنك تريد حذف هذه الفئة؟')) {
                    deleteCategory(categoryId);
                }
            });
        });
        
        // Also populate category dropdown in product modal
        const categorySelect = document.getElementById('productCategory');
        categorySelect.innerHTML = '';
        data.forEach(category => {
            const option = document.createElement('option');
            option.value = category.id;
            option.textContent = category.name;
            categorySelect.appendChild(option);
        });
    })
    .catch(error => {
        console.error('Error loading categories:', error);
    });
}

// View Product
function viewProduct(productId) {
    fetch(`https://localhost:7158/api/Products/${productId}`, {
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
        }
    })
    .then(response => response.json())
    .then(product => {
        document.getElementById('viewProductName').textContent = product.name;
        document.getElementById('viewProductDescription').textContent = product.description || 'لا يوجد وصف';
        document.getElementById('viewProductCategory').textContent = product.categoryName;
        document.getElementById('viewProductCreatedAt').textContent = new Date(product.createdAt).toLocaleString();
        document.getElementById('viewProductUpdatedAt').textContent = product.updatedAt ? new Date(product.updatedAt).toLocaleString() : 'لم يتم التحديث';

        // Display product image (correctly resolve the URL)
        const imageContainer = document.getElementById('viewProductImageContainer');
        imageContainer.innerHTML = '';
        
        if (product.imagePath) {
            const img = document.createElement('img');
            img.src = product.imagePath.startsWith('http') ? 
                product.imagePath : 
                `https://localhost:7158${product.imagePath}`;
            img.alt = product.name;
            img.style.maxHeight = '200px';
            img.onerror = function() {
                // Fallback if image fails to load
                imageContainer.innerHTML = '<p class="text-danger">الصورة غير موجودة</p>';
            };
            imageContainer.appendChild(img);
        } else {
            imageContainer.textContent = 'لا توجد صورة متاحة';
        }

        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('viewProductModal'));
        modal.show();
    })
    .catch(error => {
        console.error('Error loading product:', error);
        alert('حدث خطأ أثناء تحميل تفاصيل المنتج');
    });
}

// Edit Product
function editProduct(productId) {
    fetch(`https://localhost:7158/api/Products/${productId}`, {
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
        }
    })
    .then(response => response.json())
    .then(product => {
        // Populate form
        document.getElementById('editProductId').value = product.id;
        document.getElementById('editProductName').value = product.name;
        document.getElementById('editProductDescription').value = product.description || '';

        // Load categories into dropdown
        const categorySelect = document.getElementById('editProductCategory');
        fetch('https://localhost:7158/api/categories', {
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
            }
        })
        .then(response => response.json())
        .then(categories => {
            categorySelect.innerHTML = '';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = category.name;
                option.selected = category.id === product.categoryId;
                categorySelect.appendChild(option);
            });
        });

        // Show current image (correctly resolve the URL)
        const currentImageContainer = document.getElementById('currentProductImage');
        currentImageContainer.innerHTML = '';
        
        if (product.imagePath) {
            const img = document.createElement('img');
            img.src = product.imagePath.startsWith('http') ? 
                product.imagePath : 
                `https://localhost:7158${product.imagePath}`;
            img.alt = 'الصورة الحالية للمنتج';
            img.style.maxHeight = '150px';
            img.onerror = function() {
                // Fallback if image fails to load
                currentImageContainer.innerHTML = '<p class="text-danger">الصورة غير موجودة</p>';
            };
            currentImageContainer.appendChild(img);
        } else {
            currentImageContainer.textContent = 'لا توجد صورة حالية';
        }

        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('editProductModal'));
        modal.show();
    })
    .catch(error => {
        console.error('Error loading product for edit:', error);
        alert('حدث خطأ أثناء تحميل المنتج للتعديل');
    });
}

document.getElementById('updateProductBtn').addEventListener('click', function() {
    const productId = document.getElementById('editProductId').value;
    const formData = new FormData();

    // Required fields
    formData.append('Name', document.getElementById('editProductName').value);
    formData.append('Description', document.getElementById('editProductDescription').value);
    formData.append('CategoryId', document.getElementById('editProductCategory').value);

    // Only append ImageFile if a new file is selected
    const imageInput = document.getElementById('editProductImage');
    if (imageInput.files.length > 0) {
        formData.append('ImageFile', imageInput.files[0]);
    }

    fetch(`https://localhost:7158/api/Products/${productId}`, {
        method: 'PUT',
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
        },
        body: formData
    })
    .then(response => {
        if (!response.ok) {
            return response.json().then(err => { throw err; });
        }
        return response;
    })
    .then(() => {
        const modal = bootstrap.Modal.getInstance(document.getElementById('editProductModal'));
        modal.hide();
        loadProducts();
        alert('تم تحديث المنتج بنجاح');
    })
    .catch(error => {
        console.error('Error:', error);
        alert('حدث خطأ أثناء تحديث المنتج: ' + (error.message || 'خطأ غير معروف'));
    });
});


// Delete product
function deleteProduct(productId) {
    fetch(`https://localhost:7158/api/Products/${productId}`, {
        method: 'DELETE',
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
        }
    })
    .then(response => {
        if (response.ok) {
            loadProducts();
            updateDashboardCounts(); // Update counts after deletion
            alert('تم حذف المنتج بنجاح');
        } else {
            alert('حدث خطأ أثناء حذف المنتج');
        }
    })
    .catch(error => {
        console.error('Error deleting product:', error);
        alert('حدث خطأ أثناء حذف المنتج');
    });
}


// View Category
function viewCategory(categoryId) {
    fetch(`https://localhost:7158/api/categories/${categoryId}`, {
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
        }
    })
    .then(response => response.json())
    .then(category => {
        document.getElementById('viewCategoryName').textContent = category.name;
        document.getElementById('viewCategoryCreatedAt').textContent = new Date(category.createdAt).toLocaleString();
        document.getElementById('viewCategoryUpdatedAt').textContent = category.updatedAt ? new Date(category.updatedAt).toLocaleString() : 'لم يتم التحديث';
        
        // Get product count for this category
        fetch(`https://localhost:7158/api/Products?categoryId=${categoryId}`, {
            headers: {
                'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
            }
        })
        .then(response => response.json())
        .then(products => {
            document.getElementById('viewCategoryProductCount').textContent = products.length;
        });
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('viewCategoryModal'));
        modal.show();
    })
    .catch(error => {
        console.error('Error loading category:', error);
        alert('حدث خطأ أثناء تحميل تفاصيل الفئة');
    });
}

// Edit Category
function editCategory(categoryId) {
    fetch(`https://localhost:7158/api/categories/${categoryId}`, {
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
        }
    })
    .then(response => response.json())
    .then(category => {
        // Populate form
        document.getElementById('editCategoryId').value = category.id;
        document.getElementById('editCategoryName').value = category.name;
        
        // Show modal
        const modal = new bootstrap.Modal(document.getElementById('editCategoryModal'));
        modal.show();
    })
    .catch(error => {
        console.error('Error loading category for edit:', error);
        alert('حدث خطأ أثناء تحميل الفئة للتعديل');
    });
}

// Update Category
document.getElementById('updateCategoryBtn').addEventListener('click', function() {
    const categoryId = document.getElementById('editCategoryId').value;
    const categoryData = {
        Name: document.getElementById('editCategoryName').value
    };
    
    fetch(`https://localhost:7158/api/categories/${categoryId}`, {
        method: 'PUT',
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken'),
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(categoryData)
    })
    .then(response => {
        if (response.ok) {
            // Close modal and refresh categories
            const modal = bootstrap.Modal.getInstance(document.getElementById('editCategoryModal'));
            modal.hide();
            loadCategories();
            alert('تم تحديث الفئة بنجاح');
        } else {
            alert('حدث خطأ أثناء تحديث الفئة');
        }
    })
    .catch(error => {
        console.error('Error updating category:', error);
        alert('حدث خطأ أثناء تحديث الفئة');
    });
});

// Delete category
function deleteCategory(categoryId) {
    fetch(`https://localhost:7158/api/categories/${categoryId}`, {
        method: 'DELETE',
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
        }
    })
    .then(response => {
        if (response.ok) {
            loadCategories(); // Refresh the category list
            alert('تم حذف الفئة بنجاح');
        } else {
            alert('حدث خطأ أثناء حذف الفئة');
        }
    })
    .catch(error => {
        console.error('Error deleting category:', error);
        alert('حدث خطأ أثناء حذف الفئة');
    });
}
        
        // Load messages from API
        function loadMessages() {
            fetch('https://localhost:7158/api/contact', {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
                }
            })
            .then(response => response.json())
            .then(data => {
                const tbody = document.querySelector('#messagesTable tbody');
                tbody.innerHTML = '';
                
                data.forEach(message => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
    <td>${message.id}</td>
    <td>${message.name}</td>
    <td>${message.email}</td>
    <td>${message.phone}</td>
    <td>${message.message.substring(0, 30)}${message.message.length > 30 ? '...' : ''}</td>
    <td>${new Date(message.submittedAt).toLocaleDateString()}</td>
    <td>
        ${message.isRead ? 
            '<span class="badge bg-success">مقروء</span>' : 
            '<span class="badge bg-warning text-dark">غير مقروء</span>'}
    </td>
    <td>
        <button class="btn btn-sm btn-primary view-message-btn" data-id="${message.id}">عرض</button>
        <button class="btn btn-sm btn-danger delete-message-btn" data-id="${message.id}">حذف</button>
    </td>
`;
                    tbody.appendChild(row);
                });
                
                // Add event listeners to view buttons
                document.querySelectorAll('.view-message-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const messageId = this.getAttribute('data-id');
                        viewMessage(messageId);
                    });
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-message-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const messageId = this.getAttribute('data-id');
                        if (confirm('هل أنت متأكد أنك تريد حذف هذه الرسالة؟')) {
                            deleteMessage(messageId);
                        }
                    });
                });
            })
            .catch(error => {
                console.error('Error loading messages:', error);
            });
        }
        
        // View message details
        function viewMessage(messageId) {
            fetch(`https://localhost:7158/api/contact/${messageId}`, {
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
                }
            })
            .then(response => response.json())
            .then(message => {
                document.getElementById('messageName').textContent = message.name;
                document.getElementById('messageEmail').textContent = message.email;
                document.getElementById('messagePhone').textContent = message.phone;
                document.getElementById('messageContent').textContent = message.message;
                document.getElementById('messageSubmittedAt').textContent = new Date(message.submittedAt).toLocaleString();
                
                // Store message ID in the mark as read button
                document.getElementById('markAsReadBtn').setAttribute('data-id', messageId);
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('viewMessageModal'));
                modal.show();
            })
            .catch(error => {
                console.error('Error loading message:', error);
            });
        }
        
        // Mark message as read
        document.getElementById('markAsReadBtn').addEventListener('click', function() {
    const messageId = this.getAttribute('data-id');
    
    fetch(`https://localhost:7158/api/contact/${messageId}`, {
        method: 'GET', // Or PUT if your API supports marking as read
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
        }
    })
    .then(response => {
        if (response.ok) {
            const modal = bootstrap.Modal.getInstance(document.getElementById('viewMessageModal'));
            modal.hide();
            loadMessages();
            checkForNewItems();
                    alert('تم تحديد الرسالة كمقروءة');
                }
            })
            .catch(error => {
                console.error('Error marking message as read:', error);
                alert('حدث خطأ أثناء تحديد الرسالة كمقروءة');
            });
        });
        
        // Delete message
        function deleteMessage(messageId) {
            fetch(`https://localhost:7158/api/contact/${messageId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
                }
            })
            .then(response => {
                if (response.ok) {
                    loadMessages();
                    alert('تم حذف الرسالة بنجاح');
                } else {
                    alert('حدث خطأ أثناء حذف الرسالة');
                }
            })
            .catch(error => {
                console.error('Error deleting message:', error);
                alert('حدث خطأ أثناء حذف الرسالة');
            });
        }
        
        // Load quotes from API
        function loadQuotes() {
            const token = localStorage.getItem('adminToken');
            if (!token) {
                console.error('No admin token found');
                window.location.href = 'login.html';
                return;
            }

            // First fetch all products to create a mapping of IDs to names
            fetch('https://localhost:7158/api/Products', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(products => {
                // Create a product ID to name mapping
                const productMap = {};
                products.forEach(product => {
                    productMap[product.id] = product.name;
                });

                // Now fetch the quotes
                return fetch('https://localhost:7158/api/Quotes', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        if (response.status === 401) {
                            localStorage.removeItem('adminToken');
                            window.location.href = 'login.html';
                            return;
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    const tbody = document.querySelector('#quotesTable tbody');
                    tbody.innerHTML = '';
                    
                    if (!data || data.length === 0) {
                        tbody.innerHTML = `
                            <tr>
                                <td colspan="11" class="text-center">لا توجد طلبات عروض</td>
                            </tr>
                        `;
                        return;
                    }

                    data.forEach(quote => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${quote.id || '-'}</td>
                            <td>${quote.fullName || '-'}</td>
                            <td>${quote.company || '-'}</td>
                            <td>${quote.email || '-'}</td>
                            <td>${quote.phone || '-'}</td>
                            <td>${quote.country || '-'}</td>
                            <td>${quote.city || '-'}</td>
                            <td>${formatProductDetails(quote.productDetails, productMap)}</td>
                            <td>${quote.submittedAt ? new Date(quote.submittedAt).toLocaleString() : '-'}</td>
                            <td>${quote.isRead ? '<span class="badge bg-success">مقروء</span>' : '<span class="badge bg-warning">غير مقروء</span>'}</td>
                            <td>
                                <button class="btn btn-sm btn-primary view-quote-btn" data-id="${quote.id}">عرض</button>
                                <button class="btn btn-sm btn-danger delete-quote-btn" data-id="${quote.id}">حذف</button>
                            </td>
                        `;
                        tbody.appendChild(row);
                    });

                    // Add event listeners
                    addQuoteEventListeners();
                });
            })
            .catch(error => {
                console.error('Error loading quotes:', error);
                const tbody = document.querySelector('#quotesTable tbody');
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" class="text-center text-danger">حدث خطأ أثناء تحميل طلبات العروض: ${error.message}</td>
                    </tr>
                `;
            });
        }

        function formatProductDetails(productDetails, productMap = {}) {
            if (!productDetails) return '-';
            
            try {
                const products = JSON.parse(productDetails);
                if (Array.isArray(products)) {
                    return products.map(p => {
                        // Try to get the product name from our map, or use the ID if not found
                        return productMap[p.id] || `المنتج ${p.id}`;
                    }).join(', ');
                }
                return productMap[products.id] || `المنتج ${products.id}`;
            } catch (e) {
                // If parsing fails, try to see if it's just a product ID
                if (!isNaN(productDetails)) {
                    return productMap[productDetails] || `المنتج ${productDetails}`;
                }
                return 'منتج مخصص';
            }
        }

        // Add event listeners to quote buttons
        function addQuoteEventListeners() {
            document.querySelectorAll('.view-quote-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const quoteId = this.getAttribute('data-id');
                    viewQuote(quoteId);
                });
            });

            document.querySelectorAll('.delete-quote-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const quoteId = this.getAttribute('data-id');
                    if (confirm('هل أنت متأكد أنك تريد حذف طلب العرض هذا؟')) {
                        deleteQuote(quoteId);
                    }
                });
            });
        }

        function viewQuote(quoteId) {
            const token = localStorage.getItem('adminToken');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            // First fetch all products to create a mapping of IDs to names
            fetch('https://localhost:7158/api/Products', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(products => {
                const productMap = {};
                products.forEach(product => {
                    productMap[product.id] = product.name;
                });

                // Now fetch the specific quote
                return fetch(`https://localhost:7158/api/Quotes/${quoteId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if (!response.ok) {
                        if (response.status === 401) {
                            localStorage.removeItem('adminToken');
                            window.location.href = 'login.html';
                            return;
                        }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(quote => {
                    // Populate basic info
                    document.getElementById('quoteFullName').textContent = quote.fullName || '-';
                    document.getElementById('quoteCompany').textContent = quote.company || '-';
                    document.getElementById('quoteEmail').textContent = quote.email || '-';
                    document.getElementById('quotePhone').textContent = quote.phone || '-';
                    document.getElementById('quoteCountry').textContent = quote.country || '-';
                    document.getElementById('quoteCity').textContent = quote.city || '-';
                    document.getElementById('quoteAddress').textContent = quote.address || '-';
                    document.getElementById('quoteSubmittedAt').textContent = 
                        quote.submittedAt ? new Date(quote.submittedAt).toLocaleString() : '-';
                    document.getElementById('quoteQuantity').textContent = quote.quantity || '0';

                    // Format product details
                    const productDetailsContainer = document.getElementById('quoteProductDetails');
                    productDetailsContainer.innerHTML = '';
                    
                    try {
                        const products = quote.productDetails ? JSON.parse(quote.productDetails) : [];
                        if (products && (Array.isArray(products) ? products.length > 0 : true)) {
                            const table = document.createElement('table');
                            table.className = 'table table-bordered';
                            
                            const thead = document.createElement('thead');
                            thead.innerHTML = `
                                <tr>
                                    <th>المنتج</th>
                                    <th>الكمية</th>
                                    <th>ملاحظات</th>
                                </tr>
                            `;
                            table.appendChild(thead);
                            
                            const tbody = document.createElement('tbody');
                            
                            if (Array.isArray(products)) {
                                products.forEach(product => {
                                    const row = document.createElement('tr');
                                    row.innerHTML = `
                                        <td>${productMap[product.id] || product.name || `المنتج ${product.id}`}</td>
                                        <td>${product.quantity || 1}</td>
                                        <td>${product.notes || product.specs || '-'}</td>
                                    `;
                                    tbody.appendChild(row);
                                });
                            } else {
                                // Handle single product case
                                const row = document.createElement('tr');
                                row.innerHTML = `
                                    <td>${productMap[products.id] || products.name || `المنتج ${products.id}`}</td>
                                    <td>${products.quantity || 1}</td>
                                    <td>${products.notes || products.specs || '-'}</td>
                                `;
                                tbody.appendChild(row);
                            }
                            
                            table.appendChild(tbody);
                            productDetailsContainer.appendChild(table);
                        } else {
                            productDetailsContainer.textContent = 'لا توجد تفاصيل للمنتجات';
                        }
                    } catch (e) {
                        // If parsing fails, try to see if it's just a product ID
                        if (!isNaN(quote.productDetails)) {
                            productDetailsContainer.textContent = productMap[quote.productDetails] || `المنتج ${quote.productDetails}`;
                        } else {
                            productDetailsContainer.textContent = quote.productDetails || 'لا توجد تفاصيل للمنتجات';
                        }
                    }
                    
                    // Store quote ID in the mark as read button
                    document.getElementById('markQuoteAsReadBtn').setAttribute('data-id', quoteId);
                    
                    // Show modal
                    const modal = new bootstrap.Modal(document.getElementById('viewQuoteModal'));
                    modal.show();
                });
            })
            .catch(error => {
                console.error('Error loading quote:', error);
                alert('حدث خطأ أثناء تحميل تفاصيل طلب العرض');
            });
        }

        document.getElementById('markQuoteAsReadBtn').addEventListener('click', function() {
            const quoteId = this.getAttribute('data-id');
            const token = localStorage.getItem('adminToken');
            
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            fetch(`https://localhost:7158/api/Quotes/${quoteId}`, {
                method: 'GET', // Change to PUT if your API has a mark-as-read endpoint
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                // Close modal and refresh quotes
                const modal = bootstrap.Modal.getInstance(document.getElementById('viewQuoteModal'));
                modal.hide();
                loadQuotes();
                checkForNewItems();
                alert('تم تحديد طلب العرض كمقروء');
            })
            .catch(error => {
                console.error('Error marking quote as read:', error);
                alert('حدث خطأ أثناء تحديد طلب العرض كمقروء');
            });
        });

        // Delete quote
        function deleteQuote(quoteId) {
            fetch(`https://localhost:7158/api/Quotes/${quoteId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
                }
            })
            .then(response => {
                if (response.ok) {
                    loadQuotes(); // Refresh the quote list
                    alert('تم حذف طلب العرض بنجاح');
                } else {
                    alert('حدث خطأ أثناء حذف طلب العرض');
                }
            })
            .catch(error => {
                console.error('Error deleting quote request:', error);
                alert('حدث خطأ أثناء حذف طلب العرض');
            });
        }
        

function checkForNewItems() {
    const token = localStorage.getItem('adminToken');
    if (!token) return;

    // Check messages
    fetch('https://localhost:7158/api/contact', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => response.json())
    .then(messages => {
        const unreadMessages = messages.filter(m => !m.isRead).length;
        updateBadge('unreadMessagesBadge', unreadMessages);
        
        // Check if new messages arrived
        if (messages.length > lastMessageCount) {
            const newCount = messages.length - lastMessageCount;
            showNotification('رسالة جديدة', `لديك ${newCount} رسالة جديدة`, 'messages');
            lastMessageCount = messages.length;
        }
    });

    // Check quotes
    fetch('https://localhost:7158/api/Quotes', {
        headers: {
            'Authorization': `Bearer ${token}`
        }
    })
    .then(response => response.json())
    .then(quotes => {
        const unreadQuotes = quotes.filter(q => !q.isRead).length;
        updateBadge('unreadQuotesBadge', unreadQuotes);
        
        // Check if new quotes arrived
        if (quotes.length > lastQuoteCount) {
            const newCount = quotes.length - lastQuoteCount;
            showNotification('طلب عرض جديد', `لديك ${newCount} طلب عرض جديد`, 'quotes');
            lastQuoteCount = quotes.length;
        }
    });
}

// Update badge visibility and count
function updateBadge(elementId, count) {
    const badge = document.getElementById(elementId);
    if (!badge) return; // Exit if badge doesn't exist
    
    if (count > 0) {
        badge.textContent = count;
        badge.classList.remove('d-none');
    } else {
        badge.classList.add('d-none');
    }
    
    updateTotalNotifications();
}

// Update the total notifications badge
function updateTotalNotifications() {
    const messagesBadge = document.getElementById('unreadMessagesBadge');
    const quotesBadge = document.getElementById('unreadQuotesBadge');
    const totalBadge = document.getElementById('totalNotificationsBadge');
    
    // If any of the badges don't exist, exit the function
    if (!messagesBadge || !quotesBadge || !totalBadge) return;
    
    const messagesCount = messagesBadge.classList.contains('d-none') ? 0 : parseInt(messagesBadge.textContent);
    const quotesCount = quotesBadge.classList.contains('d-none') ? 0 : parseInt(quotesBadge.textContent);
    
    const total = messagesCount + quotesCount;
    
    if (total > 0) {
        totalBadge.textContent = total;
        totalBadge.classList.remove('d-none');
    } else {
        totalBadge.classList.add('d-none');
    }
}

// Show a notification in the dropdown and as a toast
function showNotification(title, message, targetSection) {
    // Add to dropdown
    const notificationsContainer = document.getElementById('notificationsContainer');
    const notification = document.createElement('a');
    notification.className = 'dropdown-item d-flex align-items-center';
    notification.href = '#';
    notification.innerHTML = `
        <div class="me-3">
            <div class="icon-circle bg-primary">
                <i class="fas fa-${targetSection === 'messages' ? 'envelope' : 'file-invoice'} text-white"></i>
            </div>
        </div>
        <div>
            <div class="small text-gray-500">${new Date().toLocaleString('ar-EG')}</div>
            <span class="font-weight-bold">${title}</span>
            <div>${message}</div>
        </div>
    `;
    notification.addEventListener('click', () => {
        // Switch to the relevant section when clicked
        document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.dashboard-section').forEach(el => el.classList.remove('active'));
        
        document.querySelector(`[data-section="${targetSection}"]`).classList.add('active');
        document.getElementById(`${targetSection}-section`).classList.add('active');
    });
    
  
    
    // Keep only the last 5 notifications
    if (notificationsContainer.children.length > 5) {
        notificationsContainer.removeChild(notificationsContainer.lastChild);
    }
    
    // Show toast notification
    showToastNotification(title, message);
}

// Show a toast notification
function showToastNotification(title, message) {
    const toastContainer = document.createElement('div');
    toastContainer.className = 'position-fixed bottom-0 end-0 p-3';
    toastContainer.style.zIndex = '11';
    
    const toast = document.createElement('div');
    toast.className = 'toast show';
    toast.role = 'alert';
    toast.setAttribute('aria-live', 'assertive');
    toast.setAttribute('aria-atomic', 'true');
    
    toast.innerHTML = `
        <div class="toast-header">
            <strong class="me-auto">${title}</strong>
            <small>الآن</small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            ${message}
        </div>
    `;
    
    toastContainer.appendChild(toast);
    document.body.appendChild(toastContainer);
    
    // Auto-remove after 5 seconds
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
            document.body.removeChild(toastContainer);
        }, 300);
    }, 5000);
}

// Initialize and check every 30 seconds
document.addEventListener('DOMContentLoaded', function() {
    // First check
    checkForNewItems();
    
    // Get initial counts
    fetch('https://localhost:7158/api/contact', {
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
        }
    })
    .then(response => response.json())
    .then(messages => {
        lastMessageCount = messages.length;
    });
    
    fetch('https://localhost:7158/api/Quotes', {
        headers: {
            'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
        }
    })
    .then(response => response.json())
    .then(quotes => {
        lastQuoteCount = quotes.length;
    });
    
    // Set up periodic checking
    setInterval(checkForNewItems, 30000); // Check every 30 seconds
});


        // Save new product
        document.getElementById('saveProductBtn').addEventListener('click', function() {
            const formData = new FormData();
            formData.append('Name', document.getElementById('productName').value);
            formData.append('Description', document.getElementById('productDescription').value);
            formData.append('CategoryId', document.getElementById('productCategory').value);
            formData.append('ImageFile', document.getElementById('productImage').files[0]);
            
            fetch('https://localhost:7158/api/Products', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('adminToken')
                },
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    // Close modal and refresh products
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addProductModal'));
                    modal.hide();
                    loadProducts();
                    alert('تم حفظ المنتج بنجاح');
                } else {
                    alert('حدث خطأ أثناء حفظ المنتج');
                }
            })
            .catch(error => {
                console.error('Error saving product:', error);
                alert('حدث خطأ أثناء حفظ المنتج');
            });
        });
        
        // Save new category
        document.getElementById('saveCategoryBtn').addEventListener('click', function() {
            const categoryData = {
                Name: document.getElementById('categoryName').value
            };
            
            fetch('https://localhost:7158/api/categories', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('adminToken'),
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(categoryData)
            })
            .then(response => {
                if (response.ok) {
                    // Close modal and refresh categories
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addCategoryModal'));
                    modal.hide();
                    loadCategories();
                    alert('تم حفظ الفئة بنجاح');
                } else {
                    alert('حدث خطأ أثناء حفظ الفئة');
                }
            })
            .catch(error => {
                console.error('Error saving category:', error);
                alert('حدث خطأ أثناء حفظ الفئة');
            });
        });
    </script>
</body>
</html>